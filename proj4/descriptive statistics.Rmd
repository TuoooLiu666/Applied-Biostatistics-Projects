---
title: "descriptive statistics"
author: "Tuo Liu"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse, DataExplorer, arsenal)
```

### study description
#### 1.	brief discussion of the objectives of the project and the sample

Objective: to investigate the association between smoking cessation and weight gain.   
The sample is relative large (N=1629), including information from interviews, examinations. 63 subjects were excluded due to missing value of weight difference between 1971 and 1982, and extra 41 subjects were removed because of weight loss medication. Table 1 presented a summary of the rest of samples (N=1525) by stratification on weight gain status (Yes/No). 

#### 2. identify and define outcomes, the exposure or treatment and important predictors

The major predictor was defined as number of days used an e-cigarette (use vaping and e-cigarette interchangeably) during the past 30 days. Usage of e-cigarette=1 if subject ever used or is now using e-cigarette. Usage of e-cigarette=o, otherwise. Other important predictors included subjectsâ€™ gender, age, race/ethnicity, BMI, alcohol consumption.  

The outcome variable was blood lead level. Special care should be paid to observations with lower limit of detection (LLOD) levels. Imputation method was selected accordingly to the percentage of LLOD (0.07 ug/dL) observations. 

### data read-in
```{r}
data <- read.csv("./data/nhefs.csv") %>% filter(!is.na(wt82_71) & wtloss != 1)
colnames(data)
```


### descriptive statistics
```{r results='asis'}
# create weight gain status variable
data$wtgain <- ifelse(data$wt82_71>0, "Yes", "No")

# data prep
data <- data %>% mutate(
            qsmk=factor(qsmk),
            sex=factor(sex),
            race=factor(race),
            education=factor(education)
            )

levels(data$qsmk) <- c("No", "Yes")
levels(data$sex) <- c("Male", "Female")
levels(data$race) <- c("White", "Other")
levels(data$education) <- c("8th grade or less", "High school DROPOUT", "High school","College dropout", "College or more")


# descriptive statistics for table 1
my_labels <- list(
  qsmk = "Quit smoking between 1971 and 1982",
  wtgain = "Gained weight from 1971",
  sex = "Gender",
  age = "Age (yrs) in 1971",
  race = "Race",
  education = "Education by 1971",
  smkintensity82_71 = "Increase in number of cigarettes/day from 1971 to 1982",
  smokeyrs = "YEARS OF SMOKING"
)
# # attr(data$SEX,'label')  <- 'Gender'
# # attr(data$PERIOD,'label')  <- 'Examination Cycle'
# # attr(data$CVD,'label')  <- 'CVD Status'
# 
# 
my_controls <- tableby.control(
  test = F,
  total = F,
  #numeric.test = "anova", cat.test = "chisq",
  numeric.stats = c("meansd"),
  cat.stats = c("countpct"),
  stats.labels = list(
    meansd = "Mean (SD)"
  )
)

table <- arsenal::tableby(wtgain ~  sex + age + race + education + qsmk + smokeyrs + smkintensity82_71, data = data, control = my_controls)

summary(table,
  labelTranslations = my_labels,
  title = "Summary Statistics of NHEFS 1971-1982 Data",
  pfootnote=TRUE,
  results="asis",
  digits=1
)
```


## descriptive statistic_Yujung
```{r}
table(data$qsmk)
n_miss(data$qsmk)

data$status <- as.factor(ifelse(data$qsmk == 0 & data$smokeintensity <=10, 'noqui-light',
                                ifelse(data$qsmk == 0 & data$smokeintensity <20, 'noqui-moderate',
                                       ifelse(data$qsmk == 0 & data$smokeintensity >= 20, 'noqui-heavy',
                                              ifelse(data$qsmk ==1 & data$smokeintensity <=10, 'qui-light',
                                                     ifelse(data$qsmk == 1 & data$smokeintensity <20, 'qui-moderate',
                                                            ifelse(data$qsmk == 1 & data$smokeintensity >=20, 'qui-heavy', 'other')))))))


data$chol_status <- as.factor(ifelse(data$cholesterol <200, 'Less than 200 mg/dL', 'At or above 200 mg/dL'))

data$sex <- as.factor(data$sex)
levels(data$sex) <- c("Male", "Female")
data$hbp <- as.factor(data$hbp)
levels(data$hbp) <- c("No", "Yes", "Missing" )
data$diabetes <- as.factor(data$diabetes)
levels(data$diabetes) <- c("No", "Yes", "Missing" )
data$wtloss <- as.factor(data$wtloss)
levels(data$wtloss) <- c("No", "Yes")



table(data$status)
n_miss(data$status)

# Create table
controls <- tableby.control( test = TRUE, total = TRUE,
                             numeric.test="kwt", cat.test="chisq",
                             numeric.stats = c("N", "meansd", "Nmiss"),
                             cat.stats = c("countpct" , "Nmiss"),
                             stats.labels=list(N='Count', Nmiss='Missing'))

Mylabels <- list(chol_status = "Cholesterol level", wt82_71 = "Weight change", age = "Age", sex = "Gender", hbp = "Dx Hight blood pressure", diabetes = "Dx Diabetes", wtloss = "Used weight loss medication" )

table2 <- tableby(status ~ wt82_71 + age + sex + chol_status + hbp + diabetes + wtloss, data = data, control = controls )


```

```{r results = "asis"}
summary(table2, text=TRUE, labelTranslations = Mylabels)
```


